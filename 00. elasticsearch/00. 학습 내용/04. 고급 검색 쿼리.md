# 04. ê³ ê¸‰ ê²€ìƒ‰ ì¿¼ë¦¬

---

# ìƒ˜í”Œ ë°ì´í„° ìƒì„±

ê³ ê¸‰ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ í•™ìŠµí•˜ê¸°ì— ì•ì„œ ì ì ˆí•œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.

## 1) ì¸ë±ìŠ¤ ë§¤í•‘

```json
PUT /movies
{
  "settings": {
    "analysis": {
      "analyzer": {
        "kr_text": {
          "type": "custom",
          "tokenizer": "nori_tokenizer",
          "filter": ["lowercase"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "title":        { "type": "text", "analyzer": "kr_text" },
      "overview":     { "type": "text", "analyzer": "kr_text" },
      "genres":       { "type": "keyword" },
      "year":         { "type": "integer" },
      "rating":       { "type": "float" },
      "vote_count":   { "type": "integer" },
      "popularity":   { "type": "float" },
      "actors":       { "type": "keyword" },
      "directors":    { "type": "keyword" }
    }
  }
}
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "movies"
}
```

## 2) ë°ì´í„° ìƒ‰ì¸ (Bulk API)

```json
POST /_bulk
{ "index": { "_index": "movies", "_id": 1 } }
{ "title": "ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„", "overview": "ì‚¬ë¼ì§„ ëª¨ë‘ë¥¼ ë˜ì°¾ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì „ìŸ.", "genres": ["Action","Adventure","Sci-Fi"], "year": 2019, "rating": 8.4, "vote_count": 2500000, "popularity": 98.7, "actors": ["ë¡œë²„íŠ¸ ë‹¤ìš°ë‹ˆ ì£¼ë‹ˆì–´","í¬ë¦¬ìŠ¤ ì—ë°˜ìŠ¤"], "directors": ["ì•ˆì†Œë‹ˆ ë£¨ì†Œ","ì¡° ë£¨ì†Œ"] }
{ "index": { "_index": "movies", "_id": 2 } }
{ "title": "ì¸ì…‰ì…˜", "overview": "ê¿ˆì„ í›”ì¹˜ëŠ” ë„ë‘‘ì˜ ë§ˆì§€ë§‰ ë¯¸ì…˜.", "genres": ["Action","Sci-Fi","Thriller"], "year": 2010, "rating": 8.8, "vote_count": 2300000, "popularity": 92.1, "actors": ["ë ˆì˜¤ë‚˜ë¥´ë„ ë””ì¹´í”„ë¦¬ì˜¤","ì¡°ì…‰ ê³ ë“  ë ˆë¹—"], "directors": ["í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"] }
{ "index": { "_index": "movies", "_id": 3 } }
{ "title": "ê¸°ìƒì¶©", "overview": "ë‘ ê°€ì¡±ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§.", "genres": ["Drama","Thriller"], "year": 2019, "rating": 8.6, "vote_count": 800000, "popularity": 90.5, "actors": ["ì†¡ê°•í˜¸","ì´ì„ ê· "], "directors": ["ë´‰ì¤€í˜¸"] }
{ "index": { "_index": "movies", "_id": 4 } }
{ "title": "ì¸í„°ìŠ¤í…”ë¼", "overview": "ì¸ë¥˜ì˜ ìƒì¡´ì„ ê±´ ìš°ì£¼ íƒì‚¬.", "genres": ["Adventure","Drama","Sci-Fi"], "year": 2014, "rating": 8.7, "vote_count": 1900000, "popularity": 95.2, "actors": ["ë§¤íŠœ ë§¤ì»¤ë„ˆíˆ","ì•¤ í•´ì„œì›¨ì´"], "directors": ["í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"] }
{ "index": { "_index": "movies", "_id": 5 } }
{ "title": "ìŠ¤íŒŒì´ë”ë§¨: ë…¸ ì›¨ì´ í™ˆ", "overview": "ì •ì²´ê°€ ë°í˜€ì§„ ìŠ¤íŒŒì´ë”ë§¨ì˜ ì°¨ì› ì—¬í–‰.", "genres": ["Action","Adventure"], "year": 2021, "rating": 8.3, "vote_count": 1700000, "popularity": 97.8, "actors": ["í†° í™€ëœë“œ","ì  ë°ì´ì•„"], "directors": ["ì¡´ ì™“ì¸ "] }
{
  "errors": false,
  "took": 6610999,
  "items": [
    {
      "index": {
        "_index": "movies",
        "_id": "1",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 2,
          "failed": 0
        },
        "_seq_no": 0,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "movies",
        "_id": "2",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 2,
          "failed": 0
        },
        "_seq_no": 1,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "movies",
        "_id": "3",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 2,
          "failed": 0
        },
        "_seq_no": 2,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "movies",
        "_id": "4",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 2,
          "failed": 0
        },
        "_seq_no": 3,
        "_primary_term": 1,
        "status": 201
      }
    },
    {
      "index": {
        "_index": "movies",
        "_id": "5",
        "_version": 1,
        "result": "created",
        "_shards": {
          "total": 2,
          "successful": 2,
          "failed": 0
        },
        "_seq_no": 4,
        "_primary_term": 1,
        "status": 201
      }
    }
  ]
}
```

## 3) ìƒ‰ì¸ í™•ì¸

```json
GET /movies/_search?size=3
{
  "took": 2,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 5,
      "relation": "eq"
    },
    "max_score": 1,
    "hits": [
      {
        "_index": "movies",
        "_id": "1",
        "_score": 1,
        "_source": {
          "title": "ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„",
          "overview": "ì‚¬ë¼ì§„ ëª¨ë‘ë¥¼ ë˜ì°¾ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì „ìŸ.",
          "genres": [
            "Action",
            "Adventure",
            "Sci-Fi"
          ],
          "year": 2019,
          "rating": 8.4,
          "vote_count": 2500000,
          "popularity": 98.7,
          "actors": [
            "ë¡œë²„íŠ¸ ë‹¤ìš°ë‹ˆ ì£¼ë‹ˆì–´",
            "í¬ë¦¬ìŠ¤ ì—ë°˜ìŠ¤"
          ],
          "directors": [
            "ì•ˆì†Œë‹ˆ ë£¨ì†Œ",
            "ì¡° ë£¨ì†Œ"
          ]
        }
      },
      {
        "_index": "movies",
        "_id": "2",
        "_score": 1,
        "_source": {
          "title": "ì¸ì…‰ì…˜",
          "overview": "ê¿ˆì„ í›”ì¹˜ëŠ” ë„ë‘‘ì˜ ë§ˆì§€ë§‰ ë¯¸ì…˜.",
          "genres": [
            "Action",
            "Sci-Fi",
            "Thriller"
          ],
          "year": 2010,
          "rating": 8.8,
          "vote_count": 2300000,
          "popularity": 92.1,
          "actors": [
            "ë ˆì˜¤ë‚˜ë¥´ë„ ë””ì¹´í”„ë¦¬ì˜¤",
            "ì¡°ì…‰ ê³ ë“  ë ˆë¹—"
          ],
          "directors": [
            "í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"
          ]
        }
      },
      {
        "_index": "movies",
        "_id": "3",
        "_score": 1,
        "_source": {
          "title": "ê¸°ìƒì¶©",
          "overview": "ë‘ ê°€ì¡±ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§.",
          "genres": [
            "Drama",
            "Thriller"
          ],
          "year": 2019,
          "rating": 8.6,
          "vote_count": 800000,
          "popularity": 90.5,
          "actors": [
            "ì†¡ê°•í˜¸",
            "ì´ì„ ê· "
          ],
          "directors": [
            "ë´‰ì¤€í˜¸"
          ]
        }
      }
    ]
  }
}
```

------



# ğŸ§  A. Bool Query ì‹¤ìŠµ

```json
GET /movies/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "overview": "ì „ìŸ" } }
      ],
      "filter": [
        { "term": { "genres": "Action" } },
        { "range": { "rating": { "gte": 8.0 } } }
      ]
    }
  }
}
```

â†’ â€œì „ìŸâ€ì´ë¼ëŠ” ë‹¨ì–´ê°€ ì¤„ê±°ë¦¬ì— ë“±ì¥í•˜ê³ , ì•¡ì…˜ ì¥ë¥´ì´ë©° í‰ì  8.0 ì´ìƒì¸ ì˜í™” ê²€ìƒ‰.

```json
{
  "took": 16,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.3386735,
    "hits": [
      {
        "_index": "movies",
        "_id": "1",
        "_score": 1.3386735,
        "_source": {
          "title": "ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„",
          "overview": "ì‚¬ë¼ì§„ ëª¨ë‘ë¥¼ ë˜ì°¾ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì „ìŸ.",
          "genres": [
            "Action",
            "Adventure",
            "Sci-Fi"
          ],
          "year": 2019,
          "rating": 8.4,
          "vote_count": 2500000,
          "popularity": 98.7,
          "actors": [
            "ë¡œë²„íŠ¸ ë‹¤ìš°ë‹ˆ ì£¼ë‹ˆì–´",
            "í¬ë¦¬ìŠ¤ ì—ë°˜ìŠ¤"
          ],
          "directors": [
            "ì•ˆì†Œë‹ˆ ë£¨ì†Œ",
            "ì¡° ë£¨ì†Œ"
          ]
        }
      }
    ]
  }
}
```

# ğŸ” B. Full-text Query ì‹¤ìŠµ

```json
GET /movies/_search
{
  "query": {
    "multi_match": {
      "query": "ê¿ˆì˜ ì„¸ê³„",
      "fields": ["title^3", "overview"]
    }
  }
}
```

â†’ ì˜í™” ì œëª©(`title`)ê³¼ ì¤„ê±°ë¦¬(`overview`)ì—ì„œ â€œê¿ˆì˜ ì„¸ê³„â€ ê´€ë ¨ëœ ì˜í™” ì°¾ê¸°.

â†’ `title`ì— 3ë°° ê°€ì¤‘ì¹˜ ë¶€ì—¬.

```json
{
  "took": 10,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 4,
      "relation": "eq"
    },
    "max_score": 1.768334,
    "hits": [
      {
        "_index": "movies",
        "_id": "2",
        "_score": 1.768334,
        "_source": {
          "title": "ì¸ì…‰ì…˜",
          "overview": "ê¿ˆì„ í›”ì¹˜ëŠ” ë„ë‘‘ì˜ ë§ˆì§€ë§‰ ë¯¸ì…˜.",
          "genres": [
            "Action",
            "Sci-Fi",
            "Thriller"
          ],
          "year": 2010,
          "rating": 8.8,
          "vote_count": 2300000,
          "popularity": 92.1,
          "actors": [
            "ë ˆì˜¤ë‚˜ë¥´ë„ ë””ì¹´í”„ë¦¬ì˜¤",
            "ì¡°ì…‰ ê³ ë“  ë ˆë¹—"
          ],
          "directors": [
            "í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"
          ]
        }
      },
      {
        "_index": "movies",
        "_id": "4",
        "_score": 0.30389795,
        "_source": {
          "title": "ì¸í„°ìŠ¤í…”ë¼",
          "overview": "ì¸ë¥˜ì˜ ìƒì¡´ì„ ê±´ ìš°ì£¼ íƒì‚¬.",
          "genres": [
            "Adventure",
            "Drama",
            "Sci-Fi"
          ],
          "year": 2014,
          "rating": 8.7,
          "vote_count": 1900000,
          "popularity": 95.2,
          "actors": [
            "ë§¤íŠœ ë§¤ì»¤ë„ˆíˆ",
            "ì•¤ í•´ì„œì›¨ì´"
          ],
          "directors": [
            "í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"
          ]
        }
      },
      {
        "_index": "movies",
        "_id": "3",
        "_score": 0.27779987,
        "_source": {
          "title": "ê¸°ìƒì¶©",
          "overview": "ë‘ ê°€ì¡±ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§.",
          "genres": [
            "Drama",
            "Thriller"
          ],
          "year": 2019,
          "rating": 8.6,
          "vote_count": 800000,
          "popularity": 90.5,
          "actors": [
            "ì†¡ê°•í˜¸",
            "ì´ì„ ê· "
          ],
          "directors": [
            "ë´‰ì¤€í˜¸"
          ]
        }
      },
      {
        "_index": "movies",
        "_id": "5",
        "_score": 0.27779987,
        "_source": {
          "title": "ìŠ¤íŒŒì´ë”ë§¨: ë…¸ ì›¨ì´ í™ˆ",
          "overview": "ì •ì²´ê°€ ë°í˜€ì§„ ìŠ¤íŒŒì´ë”ë§¨ì˜ ì°¨ì› ì—¬í–‰.",
          "genres": [
            "Action",
            "Adventure"
          ],
          "year": 2021,
          "rating": 8.3,
          "vote_count": 1700000,
          "popularity": 97.8,
          "actors": [
            "í†° í™€ëœë“œ",
            "ì  ë°ì´ì•„"
          ],
          "directors": [
            "ì¡´ ì™“ì¸ "
          ]
        }
      }
    ]
  }
}
```

---

## â“ ì˜ë¬¸ì 

ì–´ì§¸ì„œ â€œê¿ˆì˜ ì„¸ê³„â€ë¥¼ ê²€ìƒ‰í–ˆëŠ”ë° ìœ„ì™€ ê°™ì€ ì‘ë‹µì„ ë°›ì•˜ëŠ”ì§€ ì´í•´ê°€ ì•ˆ ëœë‹¤. í•œë²ˆ ë¶„ì„í•´ë³´ì.

### 1) ë¨¼ì € â€œì •ë§ ìš©ì–´ê°€ ê²¹ì³¤ëŠ”ì§€â€ë¶€í„° í™•ì¸

#### (a) ì¿¼ë¦¬ í…ìŠ¤íŠ¸ ë¶„ì„

```json
POST /movies/_analyze
{
  "analyzer": "kr_text",      // ë§¤í•‘ì— ì“´ analyzerì™€ ë™ì¼í•´ì•¼ í•¨
  "text": "ê¿ˆì˜ ì„¸ê³„"
}
```

â†’ ê¸°ëŒ€ í† í°: `["ê¿ˆ","ì„¸ê³„"]` (ì˜ ëŠ” ì œê±°)

> âš ï¸ ì—¬ê¸°ì„œ â€œì˜â€ê°€ ì œê±°ë˜ì–´ì•¼ í•œë‹¤ëŠ”ë°, ì‘ë‹µ ê²°ê³¼ì— â€œì˜â€ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤. ê²°êµ­ ì´ â€œì˜â€ê°€ í¬í•¨ëœ title/overviewê°€ ëª¨ë‘ ë‚˜ì˜¨ ê²ƒ ê°™ë‹¤. ìì„¸íˆ ë³´ë©´ ëª¨ë‘ â€œì˜â€ê°€ ë“¤ì–´ê°€ ìˆê³ , scoreê°€ ê°€ì¥ ë†’ì€ ì¸ì…‰ì…˜ì˜ ê²½ìš°ì—ëŠ” â€œê¿ˆâ€ê¹Œì§€ í¬í•¨í•˜ê³  ìˆë‹¤.
>
> ì´ ì™¸ì— ë” í™•ì¸ì‚¬í•­ì´ ìˆì—ˆì§€ë§Œ skipí•˜ì. ì´ê²Œ ì›ì¸ì¸ ê²ƒ ê°™ë‹¤.

------

`kr_text`(Nori)ë¡œ ë¶„ì„í–ˆì„ ë•Œ **ì¡°ì‚¬ â€˜ì˜â€™ê°€ í† í°ìœ¼ë¡œ ë‚¨ëŠ”** ê²Œ ì›ì¸ì…ë‹ˆë‹¤. ì´ëŸ¬ë©´ `multi_match`ê°€ `ê¿ˆ`, `ì˜`, `ì„¸ê³„` 3ê°œ í† í° ì¤‘ **ì•„ë¬´ê±°ë‚˜ 1ê°œë§Œ** ë§¤ì¹­ë¼ë„ hitê°€ ë  ìˆ˜ ìˆì–´ìš”(ê¸°ë³¸ `operator: OR`). ê·¸ë˜ì„œ ì¸ì…‰ì…˜ ì™¸ ë¬¸ì„œì—ë„ ë‚®ì€ ì ìˆ˜ë¡œ ë§¤ì¹­ì´ ìƒê¹ë‹ˆë‹¤.

ì•„ë˜ 2ê°€ì§€ ë°©í–¥ ì¤‘ í•˜ë‚˜(ë˜ëŠ” ë‘˜ ë‹¤)ë¥¼ ì ìš©í•˜ë©´ ê¹”ë”íˆ í•´ê²°ë©ë‹ˆë‹¤.

1. ì¬ìƒ‰ì¸ â†’ [Elasticsearch ì¬ìƒ‰ì¸ ë°©ë²•](ì¶”ê°€%20í•™ìŠµ/Elasticsearch%20ì¬ìƒ‰ì¸%20ë°©ë²•.md)

2. ì¿¼ë¦¬ ì œì–´ â†’ ì¬ìƒ‰ì¸ ì‘ì—…ì´ ë²ˆê±°ë¡œìš¸ ê²½ìš° ì„ì‹œ ë°©í¸ì´ë‹¤.

   ```json
   GET /movies/_search
   {
     "query": {
       "multi_match": {
         "query": "ê¿ˆì˜ ì„¸ê³„",
         "fields": ["title^3","overview"],
         "analyzer": "kr_text",           // ê°€ëŠ¥í•˜ë©´ kr_search ê°™ì€ ë¶ˆìš©ì–´ ì œê±° ë¶„ì„ê¸°ë¥¼ ì§€ì •
         "operator": "AND",               // ëª¨ë“  í† í° í•„ìš”
         "minimum_should_match": "2"      // ìµœì†Œ 2ê°œ ì´ìƒ ë§¤ì¹­(â€˜ì˜â€™ í•˜ë‚˜ë§Œ ë§ì•„ë„ í†µê³¼ ëª»í•¨)
       }
     }
   }
   ```

# âš™ï¸ C. Term-level & Range Query

```json
GET /movies/_search
{
  "query": {
    "range": {
      "year": { "gte": 2015 }
    }
  },
  "sort": [{ "rating": "desc" }]
}
```

â†’ 2015ë…„ ì´í›„ ê°œë´‰ì‘ ì¤‘ í‰ì  ë†’ì€ ìˆœ ì •ë ¬.

```json
{
  "took": 8,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 3,
      "relation": "eq"
    },
    "max_score": null,
    "hits": [
      {
        "_index": "movies",
        "_id": "3",
        "_score": null,
        "_source": {
          "title": "ê¸°ìƒì¶©",
          "overview": "ë‘ ê°€ì¡±ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§.",
          "genres": [
            "Drama",
            "Thriller"
          ],
          "year": 2019,
          "rating": 8.6,
          "vote_count": 800000,
          "popularity": 90.5,
          "actors": [
            "ì†¡ê°•í˜¸",
            "ì´ì„ ê· "
          ],
          "directors": [
            "ë´‰ì¤€í˜¸"
          ]
        },
        "sort": [
          8.6
        ]
      },
      {
        "_index": "movies",
        "_id": "1",
        "_score": null,
        "_source": {
          "title": "ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„",
          "overview": "ì‚¬ë¼ì§„ ëª¨ë‘ë¥¼ ë˜ì°¾ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì „ìŸ.",
          "genres": [
            "Action",
            "Adventure",
            "Sci-Fi"
          ],
          "year": 2019,
          "rating": 8.4,
          "vote_count": 2500000,
          "popularity": 98.7,
          "actors": [
            "ë¡œë²„íŠ¸ ë‹¤ìš°ë‹ˆ ì£¼ë‹ˆì–´",
            "í¬ë¦¬ìŠ¤ ì—ë°˜ìŠ¤"
          ],
          "directors": [
            "ì•ˆì†Œë‹ˆ ë£¨ì†Œ",
            "ì¡° ë£¨ì†Œ"
          ]
        },
        "sort": [
          8.4
        ]
      },
      {
        "_index": "movies",
        "_id": "5",
        "_score": null,
        "_source": {
          "title": "ìŠ¤íŒŒì´ë”ë§¨: ë…¸ ì›¨ì´ í™ˆ",
          "overview": "ì •ì²´ê°€ ë°í˜€ì§„ ìŠ¤íŒŒì´ë”ë§¨ì˜ ì°¨ì› ì—¬í–‰.",
          "genres": [
            "Action",
            "Adventure"
          ],
          "year": 2021,
          "rating": 8.3,
          "vote_count": 1700000,
          "popularity": 97.8,
          "actors": [
            "í†° í™€ëœë“œ",
            "ì  ë°ì´ì•„"
          ],
          "directors": [
            "ì¡´ ì™“ì¸ "
          ]
        },
        "sort": [
          8.3
        ]
      }
    ]
  }
}
```

# ğŸ“Š D. Aggregation ì‹¤ìŠµ

```json
GET /movies/_search
{
  "size": 0,
  "aggs": {
    "by_genre": {
      "terms": { "field": "genres" },
      "aggs": {
        "avg_rating": { "avg": { "field": "rating" } }
      }
    }
  }
}
```

â†’ ì¥ë¥´ë³„ í‰ê·  í‰ì ì„ ê³„ì‚°.

â†’ `Kibana`ì—ì„œ ì‹œê°í™”í•˜ë©´ **â€œì¥ë¥´ë³„ ì¸ê¸° ìˆœìœ„â€** ì°¨íŠ¸ ìƒì„± ê°€ëŠ¥.

```json
{
  "took": 17,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 5,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  },
  "aggregations": {
    "by_genre": {
      "doc_count_error_upper_bound": 0,
      "sum_other_doc_count": 0,
      "buckets": [
        {
          "key": "Action",
          "doc_count": 3,
          "avg_rating": {
            "value": 8.5
          }
        },
        {
          "key": "Adventure",
          "doc_count": 3,
          "avg_rating": {
            "value": 8.466666539510092
          }
        },
        {
          "key": "Sci-Fi",
          "doc_count": 3,
          "avg_rating": {
            "value": 8.633333206176758
          }
        },
        {
          "key": "Drama",
          "doc_count": 2,
          "avg_rating": {
            "value": 8.650000095367432
          }
        },
        {
          "key": "Thriller",
          "doc_count": 2,
          "avg_rating": {
            "value": 8.700000286102295
          }
        }
      ]
    }
  }
}
```

# âœ¨ E. Highlight ì‹¤ìŠµ

```json
GET /movies/_search
{
  "query": {
    "match": { "overview": "ê°€ì¡±" }
  },
  "highlight": {
    "fields": { "overview": {} },
    "pre_tags": ["<mark>"], "post_tags": ["</mark>"]
  }
}
```

â†’ ì¤„ê±°ë¦¬ ì¤‘ â€œê°€ì¡±â€ ê´€ë ¨ ë¬¸ì¥ì— `<mark>` íƒœê·¸ë¡œ ê°•ì¡° í‘œì‹œ.

```json
{
  "took": 40,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 1.3386735,
    "hits": [
      {
        "_index": "movies",
        "_id": "3",
        "_score": 1.3386735,
        "_source": {
          "title": "ê¸°ìƒì¶©",
          "overview": "ë‘ ê°€ì¡±ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§.",
          "genres": [
            "Drama",
            "Thriller"
          ],
          "year": 2019,
          "rating": 8.6,
          "vote_count": 800000,
          "popularity": 90.5,
          "actors": [
            "ì†¡ê°•í˜¸",
            "ì´ì„ ê· "
          ],
          "directors": [
            "ë´‰ì¤€í˜¸"
          ]
        },
        "highlight": {
          "overview": [
            "ë‘ <mark>ê°€ì¡±</mark>ì˜ ë§Œë‚¨ê³¼ ë¹„ê·¹ì ì¸ ê²°ë§."
          ]
        }
      }
    ]
  }
}
```

# ğŸ” F. Fuzzy ê²€ìƒ‰

```json
GET /movies/_search
{
  "query": {
    "fuzzy": {
      "title": {
        "value": "ì–´ë²¤ì €ì“°",
        "fuzziness": "2"
      }
    }
  }
}
```

â†’ ì˜¤íƒ€ â€œì–´ë²¤ì €ì“°â€ë¡œë„ â€œì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„â€ì„ ì°¾ì•„ëƒ„.

> â€œfuzzinessâ€: â€œAUTOâ€ë¡œëŠ” ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•„ì„œ â€œ2â€ë¡œ ì ìš©

```json
{
  "took": 4,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 0.62883455,
    "hits": [
      {
        "_index": "movies",
        "_id": "1",
        "_score": 0.62883455,
        "_source": {
          "title": "ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„",
          "overview": "ì‚¬ë¼ì§„ ëª¨ë‘ë¥¼ ë˜ì°¾ê¸° ìœ„í•œ ë§ˆì§€ë§‰ ì „ìŸ.",
          "genres": [
            "Action",
            "Adventure",
            "Sci-Fi"
          ],
          "year": 2019,
          "rating": 8.4,
          "vote_count": 2500000,
          "popularity": 98.7,
          "actors": [
            "ë¡œë²„íŠ¸ ë‹¤ìš°ë‹ˆ ì£¼ë‹ˆì–´",
            "í¬ë¦¬ìŠ¤ ì—ë°˜ìŠ¤"
          ],
          "directors": [
            "ì•ˆì†Œë‹ˆ ë£¨ì†Œ",
            "ì¡° ë£¨ì†Œ"
          ]
        }
      }
    ]
  }
}
```

# ğŸ”— G. Similarity ê²€ìƒ‰ (More Like This)

```json
GET /movies/_search
{
  "query": {
    "more_like_this": {
      "fields": ["overview"],
      "like": "ìš°ì£¼ íƒì‚¬",
      "min_term_freq": 1,
      "max_query_terms": 12
    }
  }
}
```

â†’ â€œìš°ì£¼ íƒì‚¬â€ë¼ëŠ” ë¬¸ì¥ê³¼ ìœ ì‚¬í•œ ì¤„ê±°ë¦¬ ì˜í™” ì¶”ì²œ (ì˜ˆ: â€œì¸í„°ìŠ¤í…”ë¼â€).

ì•„ë˜ ì‘ë‹µì€ ì˜ë„í•œ ê²°ê³¼ê°€ ì•„ë‹ˆë‹¤ (ì‹¤íŒ¨ âŒ)

```json
{
  "took": 2,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 0,
      "relation": "eq"
    },
    "max_score": null,
    "hits": []
  }
}
```

---

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

ì•„ë˜ëŠ” chatGPTì˜ ë‹µë³€ì¸ë°, ì•„ë¬´ë˜ë„ ë°ì´í„° ê·œëª¨ ìì²´ê°€ ë„ˆë¬´ ì‘ì•„ì„œ ê·¸ëŸ° ê²ƒìœ¼ë¡œ ì¶”ì¸¡ëœë‹¤. (ì²« ë²ˆì§¸ ë‹µë³€)

- `min_doc_freq` ê¸°ë³¸ê°’ì´ **5**ë¼ì„œ, â€œìš°ì£¼/íƒì‚¬â€ ê°™ì€ í† í°ì´ **5ê°œ ì´ìƒì˜ ë¬¸ì„œ**ì— ë‚˜ì˜¤ì§€ ì•Šìœ¼ë©´ ì œì™¸ë©ë‹ˆë‹¤. ì§€ê¸ˆ ì¸ë±ìŠ¤ëŠ” ì†Œê·œëª¨ë¼ í•´ë‹¹ í† í°ë“¤ì´ ì¡°ê±´ì„ ëª» ì±„ì›Œìš”.
- (ëœ í”í•œ ì´ìŠˆ) `more_like_this`ê°€ ì‚¬ìš©í•  **ë¶„ì„ê¸°**ë¥¼ ëª…ì‹œí•˜ì§€ ì•Šì•„, ì˜ë„í•œ `kr_text(nori)`ê°€ ì•ˆ ì“°ì˜€ì„ ìˆ˜ë„ ìˆì–´ìš”.
- ì…ë ¥ í…ìŠ¤íŠ¸ â€œìš°ì£¼ íƒì‚¬â€ê°€ ë¶„ì„ë˜ì–´ ë§Œë“¤ì–´ì§„ í† í°ì´ ì‹¤ì œ ë¬¸ì„œì˜ í† í°ê³¼ **ë‹¤ë¥´ê²Œ ìª¼ê°œì¡Œì„** ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ìš°ì„  ë‹¤ìŒê³¼ ê°™ì€ ì‹œë„ë¥¼ í•´ë³¸ë‹¤.

### ë¹ ë¥¸ í•´ê²°(ê¶Œì¥ ì¿¼ë¦¬)

ì•„ë˜ì²˜ëŸ¼ ì„ê³„ê°’ì„ ë‚®ì¶”ê³  ë¶„ì„ê¸°ë¥¼ ì§€ì •í•˜ì„¸ìš”.

```json
GET /movies/_search
{
  "query": {
    "more_like_this": {
      "fields": ["overview"],
      "like": "ìš°ì£¼ íƒì‚¬",
      "min_term_freq": 1,          // ë¬¸ì„œ ë‚´ ìµœì†Œ ë“±ì¥ ë¹ˆë„
      "min_doc_freq": 1,           // ì¸ë±ìŠ¤ ë‚´ ìµœì†Œ ë¬¸ì„œ ìˆ˜
      "max_query_terms": 50,       // í›„ë³´ í† í° ë„‰ë„‰íˆ
      "minimum_should_match": "1", // ìµœì†Œ ì¼ì¹˜ ê¸°ì¤€ ì™„í™”
      "analyzer": "kr_text"        // nori ì»¤ìŠ¤í…€ ë¶„ì„ê¸° ê°•ì œ
    }
  }
}
```

ì´ë ‡ê²Œ ìš”ì²­í•˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ ë‚˜ì™”ë‹¤.

```json
{
  "took": 6,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 2.928872,
    "hits": [
      {
        "_index": "movies",
        "_id": "4",
        "_score": 2.928872,
        "_source": {
          "title": "ì¸í„°ìŠ¤í…”ë¼",
          "overview": "ì¸ë¥˜ì˜ ìƒì¡´ì„ ê±´ ìš°ì£¼ íƒì‚¬.",
          "genres": [
            "Adventure",
            "Drama",
            "Sci-Fi"
          ],
          "year": 2014,
          "rating": 8.7,
          "vote_count": 1900000,
          "popularity": 95.2,
          "actors": [
            "ë§¤íŠœ ë§¤ì»¤ë„ˆíˆ",
            "ì•¤ í•´ì„œì›¨ì´"
          ],
          "directors": [
            "í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"
          ]
        }
      }
    ]
  }
}
```

ê°œì„ ëœ ìš”ì²­ì—ì„œ ëª‡ ê°€ì§€ ì˜µì…˜ì„ ë” ë¹¼ë´¤ë‹¤.

```json
GET /movies/_search
{
  "query": {
    "more_like_this": {
      "fields": ["overview"],
      "like": "ìš°ì£¼ íƒì‚¬",
      "min_term_freq": 1,          // ë¬¸ì„œ ë‚´ ìµœì†Œ ë“±ì¥ ë¹ˆë„
      "min_doc_freq": 1            // ì¸ë±ìŠ¤ ë‚´ ìµœì†Œ ë¬¸ì„œ ìˆ˜
    }
  }
}
```

ì´ë ‡ê²Œë§Œ ìš”ì²­í•´ë„ ì‘ë‹µì´ ë˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„, ì—­ì‹œ ì²« ë²ˆì§¸ ì›ì¸ì´ ë§ì•˜ë˜ ê²ƒ ê°™ë‹¤. (ìœ„ ì˜µì…˜ì€ 2ê°œ ëª¨ë‘ í•„ìš”í•˜ë‹¤)

```json
{
  "took": 5,
  "timed_out": false,
  "_shards": {
    "total": 1,
    "successful": 1,
    "skipped": 0,
    "failed": 0
  },
  "hits": {
    "total": {
      "value": 1,
      "relation": "eq"
    },
    "max_score": 2.928872,
    "hits": [
      {
        "_index": "movies",
        "_id": "4",
        "_score": 2.928872,
        "_source": {
          "title": "ì¸í„°ìŠ¤í…”ë¼",
          "overview": "ì¸ë¥˜ì˜ ìƒì¡´ì„ ê±´ ìš°ì£¼ íƒì‚¬.",
          "genres": [
            "Adventure",
            "Drama",
            "Sci-Fi"
          ],
          "year": 2014,
          "rating": 8.7,
          "vote_count": 1900000,
          "popularity": 95.2,
          "actors": [
            "ë§¤íŠœ ë§¤ì»¤ë„ˆíˆ",
            "ì•¤ í•´ì„œì›¨ì´"
          ],
          "directors": [
            "í¬ë¦¬ìŠ¤í† í¼ ë†€ë€"
          ]
        }
      }
    ]
  }
}
```

---



## ğŸ§ª H. ì‹¤ìŠµ í™•ì¥ ì•„ì´ë””ì–´

| ì£¼ì œ                 | ì„¤ëª…                                     |
| -------------------- | ---------------------------------------- |
| `bool + aggregation` | â€œ2015ë…„ ì´í›„ ê°œë´‰ì‘ ì¤‘ ì¥ë¥´ë³„ í‰ê·  í‰ì â€ |
| `highlight + fuzzy`  | â€œì˜¤íƒ€ ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŒ…â€              |
| `range + sort`       | â€œì—°ë„ë³„, í‰ì ë³„ íŠ¸ë Œë“œ ì •ë ¬â€             |
| `more_like_this`     | â€œë¹„ìŠ·í•œ ì£¼ì œì˜ ì˜í™” ì¶”ì²œ ê¸°ëŠ¥â€           |
