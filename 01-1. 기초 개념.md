#data #elasticsearch 

## 1.1 Elasticsearch란 무엇인가

**Elasticsearch는** 대용량 데이터를 실시간으로 저장하고, 검색하고, 분석하기 위한 **오픈소스 분산 검색 엔진**이다. 원래는 로그 데이터나 문서 검색을 위한 도구로 시작했지만, 현재는 검색, 통계 분석, 모니터링, 추천 시스템 등 다양한 분야에서 활용된다.

전통적인 데이터베이스는 데이터의 정합성과 트랜잭션 관리에 강점을 가지지만, 복잡한 검색(예: 특정 단어가 포함된 문서 찾기, 유사한 문장 검색)에는 비효율적이다. Elasticsearch는 이런 한계를 해결하기 위해 **검색**에 특화된 데이터 구조와 알고리즘을 기반으로 설계되었다.

핵심 철학은 다음과 같다.

- 데이터를 “*문서(document)*” 형태로 저장한다.
- 문서 내부의 텍스트를 분석하여 *색인(index)* 을 생성한다.
- 이 색인을 기반으로 빠른 검색과 통계 *집계(aggregation)* 를 수행한다.

Elasticsearch는 단독으로도 강력하지만, **Kibana**(시각화), **Logstash**(데이터 수집), **Beats**(에이전트) 와 결합하면 일명 **ELK Stack**(또는 Elastic Stack) 으로 불리며, 로그 분석, 보안 모니터링, 애플리케이션 가관측성(Observability) 등 실무 시스템 전반에 활용된다.

## 1.2 왜 Elasticsearch를 사용하는가

Elasticsearch의 강점은 “속도와 확장성”이다. 데이터가 수십억 건에 달해도, 검색어 하나를 입력하면 거의 즉시 결과를 반환할 수 있다. 이는 **역색인** 구조를 기반으로 한 검색 메커니즘 덕분이다.

또한, Elasticsearch는 **수평 확장**(horizontal scaling) 이 용이하다. 노드를 추가하면 자동으로 데이터를 분산 저장하고, 검색 요청 또한 여러 노드에 병렬로 처리한다. 덕분에 클러스터 전체가 하나의 거대한 검색 시스템처럼 동작하며, 장애가 발생해도 복제(Replica)를 통해 데이터 손실을 방지한다.

즉, Elasticsearch는
- 빅데이터 실시간 검색 및 분석,
- 로그 모니터링 및 보안 분석,
- 추천 및 개인화 서비스,
- LLM·AI 검색 시스템(벡터 검색, RAG)  

등 다양한 목적에 사용된다.

## 1.3 역색인(Inverted Index) 구조와 검색 원리

Elasticsearch의 핵심은 **역색인(Inverted Index)** 구조이다.  
이는 전통적인 “정방향 인덱스(forward index)”와 반대되는 개념이다.

- **정방향 인덱스:** 각 문서가 어떤 단어들을 포함하는지 저장한다.
- **역색인:** 각 단어가 어떤 문서에 포함되어 있는지 저장한다.

예를 들어, 다음 세 문서가 있다고 하자.

| 문서 ID | 내용                                |
| ------- | ----------------------------------- |
| 1       | “고양이가 창가에 앉아 있다.”        |
| 2       | “강아지가 창밖을 본다.”             |
| 3       | “고양이와 강아지가 함께 놀고 있다.” |

이를 역색인 구조로 바꾸면 다음과 같다.

| 단어   | 포함 문서 목록 |
| ------ | -------------- |
| 고양이 | 1, 3           |
| 강아지 | 2, 3           |
| 창가   | 1              |
| 창밖   | 2              |
| 있다   | 1, 3           |

이제 “고양이 AND 강아지”를 검색하면, Elasticsearch는 두 단어의 목록(1,3)과 (2,3)을 교집합으로 계산해 문서 3을 즉시 반환할 수 있다.

이러한 방식은 텍스트 데이터가 아무리 많아도 **O(1)에 가까운 속도로** 검색할 수 있게 해준다. 또한 색인 시점에 형태소 분석기(Analyzer)가 작동하여, 단어의 원형을 추출하고 불용어(stop words)를 제거함으로써 검색 정확도를 높인다.

## 1.4 핵심 구성요소: Document, Index, Shard, Replica

Elasticsearch는 RDBMS와 유사한 개념 체계를 가지지만, 더 유연한 구조를 지닌다.

| RDBMS    | Elasticsearch              |
| -------- | -------------------------- |
| Database | Index                      |
| Table    | Type (7.x 이후 deprecated) |
| Row      | Document                   |
| Column   | Field                      |
- **Document (문서)**  
	Elasticsearch의 최소 저장 단위. JSON 형식의 데이터로 구성된다.  
	예:
```json
{
  "id": 101,
  "name": "고양이 사료",
  "price": 12000,
  "brand": "냥냥펫"
}
```
- **Index (인덱스)**  
    유사한 문서들의 모음.  
    예: `products`, `logs`, `users` 등의 이름으로 생성한다.
- **Shard (샤드)**  
    인덱스를 물리적으로 분할한 단위. 데이터를 여러 노드에 분산 저장할 수 있게 한다.
- **Replica (복제 샤드)**  
    Shard의 복제본으로, 데이터 유실 방지 및 조회 부하 분산에 활용된다.  
    일반적으로 기본 샤드 1개당 Replica 1개를 두는 구성이 기본이다.

Elasticsearch 클러스터는 이런 구조를 통해 **분산 스토리지 + 병렬 검색 처리**를 동시에 실현한다.

## 1.5 RESTful API 구조 이해

Elasticsearch는 모든 기능이 **RESTful API** 형태로 제공된다. 즉, 명령어를 HTTP 요청으로 보낼 수 있으며, 응답은 JSON 형식으로 반환된다.

| 작업            | HTTP 메서드             | 예시                               |
| --------------- | ----------------------- | ---------------------------------- |
| 문서 색인(저장) | `PUT /index/_doc/id`    | `/products/_doc/1`                 |
| 문서 조회       | `GET /index/_doc/id`    | `/products/_doc/1`                 |
| 문서 검색       | `GET /index/_search`    | `/products/_search?q=brand:냥냥펫` |
| 문서 삭제       | `DELETE /index/_doc/id` | `/products/_doc/1`                 |

이러한 구조 덕분에 Postman, cURL, Kibana Dev Tools 등으로 쉽게 테스트할 수 있다. 또한 REST API를 통해 다른 시스템(Java, Python, Node.js 등)과의 연동이 간단하다.

## 1.6 JSON 데이터 형식 익숙해지기

Elasticsearch는 **JSON 기반의 문서형 데이터베이스**이므로, JSON 구조에 대한 이해는 필수적이다.

- 중첩 구조(Nested), 배열(Array), 객체(Object) 등을 지원한다.
- 데이터 타입은 `text`, `keyword`, `integer`, `date`, `boolean`, `nested` 등으로 매핑된다.
- **매핑**(Mapping)을 명시적으로 정의하거나, 동적 매핑(Dynamic Mapping)을 통해 자동 감지할 수 있다.

예를 들어, 다음과 같은 상품 문서를 색인하면:
```json
{
  "name": "캣타워",
  "price": 59000,
  "tags": ["고양이", "가구"],
  "details": {
    "color": "brown",
    "height": 120
  }
}
```

Elasticsearch는 이를 내부적으로 필드 단위로 분해하고, 각 **필드를 역색인** 구조로 변환하여 고속 검색을 가능하게 한다.

## 정리

Elasticsearch는 단순한 검색 도구가 아니라, **“데이터를 색인화하여 실시간 검색과 분석이 가능한 분산형 문서 저장소”** 이다.

- 역색인(Inverted Index)을 기반으로 빠른 텍스트 검색을 수행하고,
- Document, Index, Shard, Replica 구조로 수평 확장성과 안정성을 확보하며,
- RESTful API와 JSON 포맷을 통해 개발자 친화적인 환경을 제공한다.

이 기본 개념을 이해하는 것이 이후 학습 단계 (데이터 색인, 쿼리 DSL, 벡터 검색, 로그 분석, RAG 통합 등)의 출발점이 된다.
